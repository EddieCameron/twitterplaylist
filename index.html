<!DOCTYPE html>
<html>
<head>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script>

    // Find the right method, call on correct element
    function launchIntoFullscreen(element) {
        if(element.requestFullscreen) {
            element.requestFullscreen();
        } else if(element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
        } else if(element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
        } else if(element.msRequestFullscreen) {
            element.msRequestFullscreen();
        }
    }

    $(function () {
        var socket = io();
        var allTweets = [];

        Array.prototype.pickRandomElement = function () {
            var idx = Math.floor(Math.random() * this.length);
            return this.splice(idx, 1)[0];
        }

        function playNextVideo() {
            var tweetToPlay = allTweets.pickRandomElement();
            var sources = tweetToPlay.video_info.variants.map( v => "<source src=\"" + v.url + "\">" );

            var video = $('video');
            video.empty();
            video.append( sources );

            video.load();
            launchIntoFullscreen( video[0] );
      
            var nextVideoIn;
            if (tweetToPlay.type == "animated_gif")
                nextVideoIn = 10000;
            else {
                nextVideoIn =tweetToPlay.video_info.duration_millis;
                if (nextVideoIn < 10000)
                    nextVideoIn *= Math.ceil(10000 / nextVideoIn);
            }
            console.log("Playing next video in: " + nextVideoIn);

            setTimeout( playNextVideo, nextVideoIn );
        }

        socket.on('media', function(allMedia){
            console.log( JSON.stringify( allMedia ) );
            allTweets = allMedia;

            playNextVideo();
        });
    });
</script>
</head>
<body>
<video preload="none" playsinline width="1920" height="1080" autoplay loop ></video>
</body>
</html>
